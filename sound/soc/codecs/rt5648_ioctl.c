/*
 * rt5648_ioctl.h  --  RT5648 ALSA SoC audio driver IO control
 *
 * Copyright 2012 Realtek Microelectronics
 * Author: Bard <bardliao@realtek.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#include <linux/spi/spi.h>
#include <sound/soc.h>
#include "rt_codec_ioctl.h"
#include "rt5648_ioctl.h"
#include "rt5648.h"
#include <linux/HWVersion.h>

extern int Read_PROJ_ID(void);
static int PROJ_ID;

hweq_t FE380CG_hweq_param[] = {
	{/* NORMAL_DAC */
		{0},
		{0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
		 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
		0x0000,
	},
	{/* NORMAL_ADC */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0000,
        },
	{/* CLUB */
		{0},
		{0x1bbc, 0x0c73, 0x030b, 0xff24, 0x1ea6, 0xe4d9, 0x1c98, 0x589d,
		 0x01bd, 0xd344, 0x01ca, 0x2940, 0xd8cb, 0x1bbc, 0x0000, 0xef01,
		 0x1bbc, 0x0000, 0xef01, 0x1bbc, 0x0000, 0x0257, 0x0000, 0x1cc9,
		 0x02eb, 0x1cee, 0x0800, 0x0800},
		0x0082,
	},
	{/* SPK_WITHOUT_EFFECT */
                {0},
                {0x1c10, 0x0000, 0x03ec, 0x26d4, 0x1e09, 0x591f, 0x1c11, 0x29f9,
                 0x01f9, 0x5d48, 0x01fe, 0xa28a, 0xf0d7, 0x1a93, 0xfb54, 0xc0db,
                 0x1f69, 0xfb54, 0x0bdb, 0x0dd0, 0xf805, 0x0436, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800,
		 0x1c10, 0x0000, 0x03e0, 0xa3c8, 0x1e15, 0x5b87, 0x1c12, 0xbd95,
                 0x01f7, 0x63aa, 0x01f9, 0x9292, 0xd588, 0x1c10, 0x0000, 0xc147,
                 0x1f03, 0xf805, 0x0dd0, 0x1561, 0x0000, 0x0436, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800},
                0x005e,
	},
        {/* SPK_WITH_EFFECT */
                {0},
                {0x1c10, 0x0000, 0x03ec, 0x26d4, 0x1e09, 0x591f, 0x1c11, 0x29f9,
                 0x01f9, 0x5d48, 0x01fe, 0xa28a, 0xf0d7, 0x1a93, 0xfb54, 0xc0db,
                 0x1f69, 0xfb54, 0x0bdb, 0x0dd0, 0xf805, 0x0436, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800,
                 0x1c10, 0x0000, 0x03e0, 0xa3c8, 0x1e15, 0x5b87, 0x1c12, 0xbd95,
                 0x01f7, 0x63aa, 0x01f9, 0x9292, 0xd588, 0x1c10, 0x0000, 0xc147,
                 0x1f03, 0xf805, 0x0dd0, 0x1561, 0x0000, 0x0436, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800},
                0x0040,
        },
	{/* VOICE_RCV */
		{0},
		{0xfbca, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc17e, 0x1e8b, 0x2fb2, 0xcc71,
                 0x1454, 0xf405, 0xc456, 0x1f02, 0x0fec, 0x1c10, 0x01f4, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800,
                 0xfbca, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc17e, 0x1e8b, 0x2fb2, 0xcc71,
                 0x1454, 0x0405, 0xc456, 0x1f02, 0x0fec, 0x1c10, 0x01f4, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800},
                0x10dc,
	},
	{/* VOICE_SPK */
		{0},
                {0x0fc7, 0x0000, 0x039f, 0x5948, 0x1e14, 0x3eb3, 0x1c53, 0xf175,
                 0x01f9, 0x82a0, 0x01f9, 0x141e, 0xc39f, 0x1d21, 0xf405, 0xc2b8,
                 0x1da3, 0xf604, 0xc380, 0x1f20, 0xfcdc, 0x0436, 0x0000, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800,
                 0x0fc7, 0x0000, 0x039f, 0x5948, 0x1e14, 0x3eb3, 0x1c53, 0xf175,
                 0x01f9, 0x82a0, 0x01f9, 0x141e, 0xc39f, 0x1d21, 0xf405, 0xc2b8,
                 0x1da3, 0xf604, 0xc380, 0x1f20, 0xfcdc, 0x0436, 0x0000, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800},
                0x30de,
	},
	{/* HP */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
	},
	{/* VOICE_HP */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
        },
        {/* BOARD_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd29a, 0x193a, 0x2c22,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0104,
        },
	{/* HEADSET_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd2b7, 0x1cd0, 0x095b,
                 0xdf5d, 0x188d, 0x0699, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x000c,
        },
	{/* VOICE_BOARD_MIC_RECORD */
                {0},
                {0x0436, 0x0000, 0xe904, 0x1c10, 0x01f4, 0xc38f, 0x1df8, 0x0fec,
                 0xc170, 0x1f95, 0x0fec, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x010d,
        },
	
};
#ifdef CONFIG_FE380CG
#define RT5648_HWEQ_LEN ARRAY_SIZE(FE380CG_hweq_param)
#define RT5648_HWDRC_LEN 0
#endif

hweq_t FE171MG_hweq_param[] = {
        {/* NORMAL_DAC */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
        },
        {/* NORMAL_ADC */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0000,
        },
        {/* CLUB */
                {0},
                {0x1bbc, 0x0c73, 0x030b, 0xff24, 0x1ea6, 0xe4d9, 0x1c98, 0x589d,
                 0x01bd, 0xd344, 0x01ca, 0x2940, 0xd8cb, 0x1bbc, 0x0000, 0xef01,
                 0x1bbc, 0x0000, 0xef01, 0x1bbc, 0x0000, 0x0257, 0x0000, 0x1cc9,
                 0x02eb, 0x1cee, 0x0800, 0x0800},
                0x0082,
        },
        {/* SPK */
                {0},
                {0x1c10, 0x0000, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x2000, 0x0000, 0x2000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800,
                 0x1c10, 0x0000, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x2000, 0x0000, 0x2000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800},
                0x0040,
        },
        {/* VOICE_RCV */
                {0},
                {0xfbca, 0x0000, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0xc17e, 0x1e8b, 0x2fb2, 0xcc71,
                 0x1454, 0xf405, 0xc456, 0x1f02, 0x0fec, 0x0000, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0xc17e, 0x1e8b, 0x2fb2, 0xcc71,
                 0x1454, 0x0405, 0xc456, 0x1f02, 0x0fec, 0x0000, 0x0000, 0x1f68,
                 0x0094, 0x1f69, 0x0800, 0x0800},
                0x109c,
        },
        {/* VOICE_SPK */
                {0},
                {0x0adc, 0x0000, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0xf8f5, 0xfb38, 0xf405, 0xc1b3,
                 0x1f2c, 0x0c73, 0xdf5e, 0x09fd, 0xf405, 0x0000, 0x0000, 0x1ed0,
                 0x0124, 0x1ed6, 0x0800, 0x0800,
                 0x0adc, 0x0000, 0xc5e9, 0x1a98, 0x1d2c, 0xc882, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0xf858, 0xfb38, 0xf405, 0xc1b3,
                 0x1f2c, 0x0c73, 0xdf5e, 0x09fd, 0xf405, 0x0000, 0x0000, 0x1ed0,
                 0x0124, 0x1ed6, 0x0800, 0x0800},
                0x30dc,
        },
        {/* HP */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
        },
        {/* VOICE_HP */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
        },
        {/* BOARD_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd29a, 0x193a, 0x2c22,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0104,
        },
        {/* HEADSET_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd2b7, 0x1cd0, 0x095b,
                 0xdf5d, 0x188d, 0x0699, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x000c,
        },
        {/* BOARD_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd29a, 0x193a, 0x2c22,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0104,
        },
        {/* HEADSET_MIC_RECORD */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xd2b7, 0x1cd0, 0x095b,
                 0xdf5d, 0x188d, 0x0699, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x000c,
        },
        {/* VOICE_BOARD_MIC_RECORD */
                {0},
                {0x0436, 0x0000, 0xe904, 0x1c10, 0x01f4, 0xc38f, 0x1df8, 0x0fec,
                 0xc170, 0x1f95, 0x0fec, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x010d,
        },

};
#ifdef CONFIG_FE171MG
#define RT5648_HWEQ_LEN ARRAY_SIZE(FE171MG_hweq_param)
#define RT5648_HWDRC_LEN 0
#endif

hweq_t Z580C_hweq_param[] = {
        {/* NORMAL_DAC */
                {0},
                {0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800,
                 0x1c10, 0x01f4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
                 0x0000, 0x0000, 0x0200, 0x0000, 0xc882, 0x1c10, 0x01f4, 0xe904,
                 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4, 0x2000,
                 0x0000, 0x2000, 0x0800, 0x0800},
                0x0000,
        },
        {/* NORMAL_ADC */
                {0},
                {0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4,
                 0xe904, 0x1c10, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x0000,
        },
        {/* PLAYBACK - SPK */
                {0},
                {0x1c10, 0x0000, 0x03b8, 0xc378, 0x1e3f, 0x03dd, 0x1c22, 0x96d9,
                 0x01e5, 0xf2c6, 0x01ed, 0x092a, 0xd588, 0x1c10, 0x0000, 0xe904,
                 0x1c10, 0x0000, 0x0000, 0x1c10, 0x0000, 0x0436, 0x0000, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800,
                 0x1c10, 0x0000, 0x03b8, 0xc378, 0x1e3f, 0x03dd, 0x1c22, 0x96d9,
                 0x01e5, 0xf2c6, 0x01ed, 0x092a, 0xd588, 0x1c10, 0x0000, 0xe904,
                 0x1c10, 0x0000, 0x0000, 0x1c10, 0x0000, 0x0436, 0x0000, 0x1f1c,
                 0x00dd, 0x1f1f, 0x0800, 0x0800},
                0x0040,
        },
        {/* RECORD - BOARD MIC */
                {0},
                {0x0436, 0x01f4, 0xe904, 0x1c10, 0x01f4, 0xdc1d, 0x12c1, 0xf405,
                 0xe3ce, 0x12c1, 0xf405, 0xe904, 0x1c10, 0x01f4, 0x1c10, 0x01f4,
                 0x0800, 0x0800},
                0x010d,
        },
};

hweq_t Z580C_drc_param[] = {
	{/*Off*/
		{0xb3,   0xb4,   0xb5,   0xb6,   0xb7},
		{0x001f, 0x0206, 0x1f00, 0x0000, 0x4000},
		0x0000,
	},
	{/*SPK 5V*/
		{0xb3,   0xb4,   0xb5,   0xb6,   0xb7},
		{0x041f, 0x440a, 0xe0e0, 0x001f, 0x401a},
		0x0000,
	},
	{/*SPK VSYS*/
		{0xb3,   0xb4,   0xb5,   0xb6,   0xb7},
		{0x041f, 0x420c, 0xdfe0, 0x001f, 0x4012},
		0x0000,
	},
};
#ifdef CONFIG_Z580C
#define RT5648_HWEQ_LEN ARRAY_SIZE(Z580C_hweq_param)
#define RT5648_HWDRC_LEN ARRAY_SIZE(Z580C_drc_param)
#endif

int eqreg[EQ_CH_NUM][EQ_REG_NUM] = {
	{0xa4, 0xa5, 0xeb, 0xec, 0xed, 0xee, 0xe7, 0xe8, 
	 0xe9, 0xea, 0xe5, 0xe6, 0xae, 0xaf, 0xb0, 0xb4, 
	 0xb5, 0xb6, 0xba, 0xbb, 0xbc, 0xc0, 0xc1, 0xc4, 
	 0xc5, 0xc6, 0xca, 0xcc,
	 0xa6, 0xa7, 0xf5, 0xf6, 0xf7, 0xf8, 0xf1, 0xf2, 
	 0xf3, 0xf4, 0xef, 0xf0, 0xb1, 0xb2, 0xb3, 0xb7, 
	 0xb8, 0xb9, 0xbd, 0xbe, 0xbf, 0xc2, 0xc3, 0xc7, 
	 0xc8, 0xc9, 0xcb, 0xcd},
	{0xce, 0xcf, 0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7, 0xd8,
	 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xe1, 0xe2,
         /* Redundant ADC EQ register index */
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
};

int rt5648_update_eqmode(
	struct snd_soc_codec *codec, int channel, int mode)
{
	struct rt_codec_ops *ioctl_ops = rt_codec_get_ioctl_ops();
	int i, upd_reg, reg, mask;
	hweq_t *proj_hweq_param;

	if (codec == NULL ||  mode >= RT5648_HWEQ_LEN) {
		pr_err("%s : return error, mode = %d\n", __func__, mode);
		return -EINVAL;
	}

	pr_debug("%s(): mode=%d\n", __func__, mode);

	PROJ_ID = Read_PROJ_ID();
	if (PROJ_ID == PROJ_ID_FE380CG || PROJ_ID == PROJ_ID_FE380CXG)
		proj_hweq_param = FE380CG_hweq_param;
	else if (PROJ_ID == PROJ_ID_Z580C || PROJ_ID == PROJ_ID_Z580CA)
		proj_hweq_param = Z580C_hweq_param;
	else if (PROJ_ID == PROJ_ID_FE171MG)
		proj_hweq_param = FE171MG_hweq_param;
	
	for (i = 0; i < EQ_REG_NUM; i++) {
		proj_hweq_param[mode].reg[i] = eqreg[channel][i];
	}

	for (i = 0; i < EQ_REG_NUM; i++) {
		if (proj_hweq_param[mode].reg[i]) {
			ioctl_ops->index_write(codec, proj_hweq_param[mode].reg[i],
					proj_hweq_param[mode].value[i]);
		} else {
			break;
		}
	}

	switch (channel) {
	case EQ_CH_DAC:
		reg = RT5648_EQ_CTRL2;
		mask = 0x33fe;
		upd_reg = RT5648_EQ_CTRL1;
		break;
	case EQ_CH_ADC:
		reg = RT5648_ADC_EQ_CTRL2;
		mask = 0x01bf;
		upd_reg = RT5648_ADC_EQ_CTRL1;
		break;
	default:
		printk(KERN_ERR "Invalid EQ channel\n");
		return -EINVAL;
	}

	snd_soc_update_bits(codec, reg, mask, proj_hweq_param[mode].ctrl);
	snd_soc_update_bits(codec, upd_reg,
		RT5648_EQ_UPD, RT5648_EQ_UPD);
	snd_soc_update_bits(codec, upd_reg, RT5648_EQ_UPD, 0);

	return 0;
}

int rt5648_update_drc_agc(
	struct snd_soc_codec *codec, int mode)
{
	int i;
	if (codec == NULL || mode >= RT5648_HWDRC_LEN) {
		pr_err("%s : wrong mode %d\n", __func__, mode);
		return -EINVAL;
	} else {
		pr_debug("%s : mode %d\n", __func__, mode);
	}
	for(i = 0; i < 5; i++) {
		if(Z580C_drc_param[mode].reg[i])
			snd_soc_write(codec, Z580C_drc_param[mode].reg[i],
					Z580C_drc_param[mode].value[i]);
	}
	return 0;
}

int rt5648_ioctl_common(struct snd_hwdep *hw, struct file *file,
			unsigned int cmd, unsigned long arg)
{
	struct snd_soc_codec *codec = hw->private_data;
	struct rt_codec_cmd __user *_rt_codec = (struct rt_codec_cmd *)arg;
	struct rt_codec_cmd rt_codec;
	/* struct rt_codec_ops *ioctl_ops = rt_codec_get_ioctl_ops(); */
	int *buf;
	static int eq_mode[EQ_CH_NUM];

	if (copy_from_user(&rt_codec, _rt_codec, sizeof(rt_codec))) {
		dev_err(codec->dev, "copy_from_user faild\n");
		return -EFAULT;
	}
	dev_dbg(codec->dev, "%s(): rt_codec.number=%d, cmd=%d\n",
			__func__, rt_codec.number, cmd);
	buf = kmalloc(sizeof(*buf) * rt_codec.number, GFP_KERNEL);
	if (buf == NULL)
		return -ENOMEM;
	if (copy_from_user(buf, rt_codec.buf, sizeof(*buf) * rt_codec.number))
		goto err;

	switch (cmd) {
	case RT_SET_CODEC_HWEQ_IOCTL:
		if (eq_mode == *buf)
			break;
		eq_mode[*buf] = *(buf + 1);
		rt5648_update_eqmode(codec, eq_mode[*buf], *buf);
		break;

	case RT_GET_CODEC_ID:
		*buf = snd_soc_read(codec, RT5648_VENDOR_ID2);
		if (copy_to_user(rt_codec.buf, buf, sizeof(*buf) * rt_codec.number))
			goto err;
		break;
	default:
		break;
	}

	kfree(buf);
	return 0;

err:
	kfree(buf);
	return -EFAULT;
}
EXPORT_SYMBOL_GPL(rt5648_ioctl_common);
